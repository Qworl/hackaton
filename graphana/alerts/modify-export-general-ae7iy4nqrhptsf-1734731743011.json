{"apiVersion":1,"groups":[{"orgId":1,"name":"general","folder":"alerts","interval":"1m","rules":[{"uid":"ae7iy4nqrhptsf","title":"Индекс клиентского сервиса alert","condition":"B","data":[{"refId":"A","relativeTimeRange":{"from":21600,"to":0},"datasourceUid":"ee7ipvutn2u4ga","model":{"datasource":{"type":"grafana-postgresql-datasource","uid":"ee7ipvutn2u4ga"},"editorMode":"code","format":"table","intervalMs":60000,"maxDataPoints":43200,"rawQuery":true,"rawSql":"SELECT \r\n    CASE \r\n        WHEN (COUNT(*) FILTER (WHERE feedback_type IN (2, 3)) * 100.0 / COUNT(*)) \u003e 25 THEN 10\r\n        WHEN (COUNT(*) FILTER (WHERE feedback_type = 1) * 100.0 / COUNT(*)) \u003e 95 THEN 1\r\n        ELSE ROUND(10 - (COUNT(*) FILTER (WHERE feedback_type = 1) * 10.0 / COUNT(*)))\r\n    END AS customer_service_index\r\nFROM feedback;","refId":"A","sql":{"columns":[{"name":"AVG","parameters":[{"name":"grade","type":"functionParameter"}],"type":"function"}],"groupBy":[{"property":{"name":"is_quailfied","type":"string"},"type":"groupBy"}],"limit":50},"table":"feedback"}},{"refId":"B","relativeTimeRange":{"from":0,"to":0},"datasourceUid":"__expr__","model":{"conditions":[{"evaluator":{"params":[1,0],"type":"lt"},"operator":{"type":"and"},"query":{"params":[]},"reducer":{"params":[],"type":"avg"},"type":"query"}],"datasource":{"name":"Expression","type":"__expr__","uid":"__expr__"},"expression":"A","intervalMs":1000,"maxDataPoints":43200,"refId":"B","type":"threshold"}}],"dashboardUid":"be7iqxn261bswf","panelId":3,"noDataState":"KeepLast","execErrState":"Error","for":"1m","annotations":{"__dashboardUid__":"be7iqxn261bswf","__panelId__":"3","description":"Значение ИКС упало ниже 1","summary":"Значение ИКС упало ниже 1"},"labels":{},"isPaused":false,"notification_settings":{"receiver":"grafana-default-email"}}]}]}